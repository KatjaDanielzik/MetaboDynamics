---
title: "how_to_build_a_package"
author: "Katja Danielzik"
date: "2024-08-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

---
title: "Creating_packages"
author: "Katja Danielzik"
date: "2024-08-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This is a follow along of the bock "R packages: 2nd edition" by Hadley Wickham
and Jennifer Bryan (https://r-pkgs.org/).

# System setup
install current R version (4.4.1)
```{bash}
# update indices
sudo apt update -qq
# install two helper packages we need
sudo apt install --no-install-recommends software-properties-common dirmngr
# add the signing key (by Michael Rutter) for these repos
# To verify key, run gpg --show-keys /etc/apt/trusted.gpg.d/cran_ubuntu_key.asc 
# Fingerprint: E298A3A825C0D65DFD57CBB651716619E084DAB9
wget -qO- https://cloud.r-project.org/bin/linux/ubuntu/marutter_pubkey.asc | sudo tee -a /etc/apt/trusted.gpg.d/cran_ubuntu_key.asc
# add the R 4.0 repo from CRAN -- adjust 'focal' to 'groovy' or 'bionic' as needed
sudo add-apt-repository "deb https://cloud.r-project.org/bin/linux/ubuntu $(lsb_release -cs)-cran40/"
# install base r
sudo apt install r-base
# install development tools
sudo apt install r-base-dev
```

## install necessary packages 
```{r}
install.packages(c("devtools","roxygen2","testthat","knitr"))
library(devtools)
# attach devtools for every R session
if (interactive()) {
  suppressMessages(require(devtools))
}
```

## check if necessary packages are installed
```{r}
devtools::dev_sitrep()
```
── R ────────────────────────────────────────────────────────────────────────────────────────────────
• version: 4.4.1
• path: '/usr/lib/R/'
── RStudio ──────────────────────────────────────────────────────────────────────────────────────────
• version: 2024.4.2.764
── devtools ─────────────────────────────────────────────────────────────────────────────────────────
• version: 2.4.5
── dev package ──────────────────────────────────────────────────────────────────────────────────────
• package: <unset>
• path: <unset>
✔ All checks passed

## Git repository
create a new folder and a new git repository, initial git in the folder and set
the git repository to 
Disable automatic workspace save: tools > global options > Restore .RData uncheck,
Save workspace to .RData -> change to "never"
Go to terminal in RStudio 
```{bash}
git config --global credential.helper store
# confirmation with 
git config credential.helper
```
store

```{bash}
# I am using a local credential helper here for this project as I am normally
# pushing to gitlab, if global than "git config --global ..."
git config user.name "KatjaDanielzik"
git config user.email "katja.danielzik@uni-due.de"
```

create a token for the current github project https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens

```{r}
install.packages("gitcreds")

gitcreds::gitcreds_set()
```
Show in New Window

-> Your current credentials for 'https://github.com':

  protocol: https
  host    : github.com
  username: PersonalAccessToken
  password: <-- hidden -->

-> What would you like to do? 

1: Abort update with error, and keep the existing credentials
2: Replace these credentials
3: See the password / token

can also be used to see the password/token

# Building a toy package
devtools package is a public face set of packages that support package development
## creating a package
```{r}
library(devtools)
# initialize a new package in a directory 
create_package("/media/home/MetaboDynamics")
```

## use git
```{r}
use_git()
```
✔ Setting active project to "/media/home/MetaboDynamics".
✔ Adding ".Rhistory", ".Rdata", ".httr-oauth", ".DS_Store", and ".quarto" to .gitignore.
ℹ There are 6 uncommitted files:
• .gitignore
• .Rbuildignore
• DESCRIPTION
• how_to_create_a_package.Rmd
• MetaboDynamics.Rproj
• NAMESPACE
! Is it ok to commit them?

1: Definitely
2: No
3: Not now

Selection: 1
✔ Adding files.
✔ Making a commit with message "Initial commit".

## first function
### define function
```{r}
strsplit1 <- function(x,split){
  strsplit(x,split=split)[[1]]
}
```
### save in an R file
```{r}
use_r("strplit1")
```

put definition of the function and NOTHING else in the file and then save.

### make function available
usually we would just source the R script in the global enviroment, but not 
in package development
```{r}
load_all()
```
makes all functions availale (not in the global enviroment) and simulates the process
 of building, installing, and attaching the new package. 
```{r}
exists("strsplit1",where=globalenv(),inherits=F)
```
[1] FALSE

### commit function


