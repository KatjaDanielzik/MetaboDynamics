---
title: "filling_package_skeleton_with_life"
author: "Katja Danielzik"
date: "2024-08-07"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# setup package documentation
```{r}
use_package_doc()
document()
```


# dependencies
```{r}
use_package("stringr", "imports",min_version=TRUE) # min_version=TRUE sets to current version
use_package("rstan","imports",min_version = TRUE)
use_package("ggplot2","imports",min_version=TRUE)
use_package("dplyr","imports",min_version=TRUE)
use_package("tidyr","imports",min_version = TRUE)
```


# raw data 
will be worked on later

# data
import already pre-processed intracellular metabolite concentrations with one
column specifying the experimental condition (in our case radiation dose) and
one column specifying time (numerical)

## intracellular concentrations
```{r}
intra <- read_csv("/media/home/5-1-package pipeline/data/intra_corrected_cell_counts.csv")
# save as rda file
use_data(intra)
# write documentation
promptData(intra)
```
## model fit for Vignette building
```{r}
# skip posteriors to reduce data size
diagnostics_dynamics <- diagnostics_dynamics["model_diagnostics"]
use_data(diagnostics_dynamics,overwrite = TRUE)
promptData(diagnostics_dynamics)
estimates_dynamics <- estimates_dynamics[c("0Gy","2Gy","10Gy")]
use_data(estimates_dynamics,overwrite=TRUE)
promptData(estimates_dynamics)
```


## KEGG-database 
these files are summaries of the pull request from KEGG via KEGGREST
```{r}
# total background information
modules_compounds  <- readr::read_csv("/media/home/5.1-package-pipeline/modules_compounds.csv")
#correct spelling error
colnames(modules_compounds) <- gsub("hierachy","hierarchy",colnames(modules_compounds))
usethis::use_data(modules_compounds,overwrite=TRUE)
promptData(modules_compounds)

# experimental metabolites mapped to modules
metabolite_modules <- readr::read_csv("/media/home/5.1-package-pipeline/metabolite_modules.csv")
colnames(metabolite_modules) <- gsub("hierachy","hierarchy",colnames(metabolite_modules))
usethis::use_data(metabolite_modules,overwrite=TRUE)
promptData(metabolite_modules)

# suggest KEGGREST as package for developers to test the code or obtain own datasets
devtools::use_package("KEGGREST","suggests",min_version=TRUE)
devtools::document()
```

That is all we need for now.

# functions
## fit_dynamics_model
```{r}
use_r("fit_dynamics_model.R")
document()
load_all()
use_test("fit_dynamics_model.R")

# check if everything is available
MetaboDynamics::fit_dynamics_model() # is available
help("fit_dynamics_model") # should open help page
```

### extract_diagnostics_dynamics
```{r}
use_r("extract_diagnostics_dynamics.R")
document()
```

### extract_estimates_dynamics
```{r}
use_r("extract_estimates_dynamics.R")
document()
```

## OverRepresentationAnalysis with hypergeometric model
```{r}
use_r("ORA_hypergeometric.R")
document()
```

## compare_conditions
```{r}
use_r("compare_dynamics.R")
document()
use_r("compare_metabolites.R")
document()
```

